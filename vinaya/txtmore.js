// 導入模組
var fs = require('fs')
var path = require('path')
// 可改寫檔名及編碼
var x = '.ini'
var ru = 'utf8'
var wu = 'utf8'
// 取出檔名
var y
// 完成後的副檔名
var afterName = '.html'
// 設定分層數量，0表示只1層，1表示2層
var AA = 0

// 建立函數，以便回呼使用
function XmlAddMypb(go) {
    // 規範化檔案路徑
    var h = path.normalize(go)
    // 取得本檔檔名，以本檔檔名作參數，在當前目錄下：若有相同名的副檔名的檔案，就進行轉換
    // 取得當前目錄下所有檔案及資料夾
    var d = fs.readdirSync(h)
    // 循環目錄
    for (var k of d) {
        // 取得絕對路徑，並規範化路徑
        var n = path.normalize(h + '/' + k)
        // 取得檔案資訊
        var c = fs.statSync(n)
        // 判斷是否為資料夾，如果是：回呼函數，來執行下一層目錄
        // 跳過.git && .vscode
        if (c.isDirectory() && n != '.git' && n != '.vscode') {
            // 若只執行當前目錄，則註釋此行，並啟動返回通知
            // XmlAddMypb(n)
            console.log('Stop read Directory:' + n)

            // 判斷是否為所要轉換的副檔名的檔案
        } else if (path.extname(n) == x) {
            // 用絕對路徑讀入檔案，使用node的readFileSync同步函數
            // 先處理一些內文
            var a = fs.readFileSync(n, ru)
            // 進行你要的操作

            // 刪除副檔名
            y = k.replace(/([^\.]+)\..+/, '$1')

            var head = '<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="UTF-8" />\n	<title>' + y + '</title>\n	<base target="_blank">\n<style id="accelon2017">\nje{color: olivedrab;font-weight: 800;}\nle{color: darkviolet;font-weight: 800;}\nxa{color: royalblue;font-weight: 800;}\nwi{color: dodgerblue;font-weight: 800;}\npe{color: sienna;font-weight: 800;}\nlittle{color: red;font-weight: 800;font-size: 0.7em;}\nzi{color: red;font-weight: 800;}\ngroup{color: blueviolet;font-weight: 800;}\nby{color: blue;font-weight: 700;}\nbf{color: purple;font-weight: 700;}\nbz{color: darkgreen;font-weight: 700;}\nask{color: limegreen;font-weight: 700;}\nrep{color: darkred;font-weight: 700;}\nsi{color: rgba(150, 15, 15, 0.856);font-weight: 700;}\nsr{color: rgb(55, 122, 230);font-weight: 700;}\nyear{color: mediumorchid;font-weight: 700;}\nh0{color: lime;font-weight: 700;}\nbook{color: rgb(30, 194, 30);font-weight: 700;}\nsarticle{color: rgba(15, 179, 15, 0.459);font-weight: 700;}\nva{color: olivedrab;font-weight: 700;}\neng{color: dodgerblue;font-weight: 700;}\ntalk{color: steelblue;font-weight: 700;}\nother { color:hsl(300,60%,40%);font-weight: 700;}\n\nh1 { color:hsl(60,60%,30%);}\nh2 { color:hsl(90,60%,30%);}\nh3 { color:hsl(120,60%,30%);}\nh4 { color:hsl(150,60%,30%);}\nh5 { color:hsl(180,60%,30%);}\nh6 { color:hsl(210,60%,30%);}\n\n\n@media (prefers-color-scheme: dark) {\n/* *{color: yellow;background: black;} */\nje{color: darkseagreen;font-weight: 800;}\nle{color: mediumpurple;font-weight: 800;}\nxa{color: mediumturquoise;font-weight: 800;}\nwi{color: skyblue;font-weight: 800;}\npe{color: palegoldenrod;font-weight: 800;}\nlittle{color: hotpink;font-weight: 800;font-size: 0.7em;}\nzi{color: hotpink;font-weight: 800;}\ngroup{color: orchid;font-weight: 800;}\nby{color: lightblue;font-weight: 700;}\nbf{color: plum;font-weight: 700;}\nbz{color: greenyellow;font-weight: 700;}\nask{color: lime;font-weight: 700;}\nrep{color: red;font-weight: 700;}\nsi{color: magenta;font-weight: 700;}\nsr{color: cyan;font-weight: 700;}\nyear{color: mediumorchid;font-weight: 700;}\nh0{color: lime;font-weight: 700;}\nbook{color: lightgreen;font-weight: 700;}\nsarticle{color: greenyellow;font-weight: 700;}\nva{color: yellowgreen;font-weight: 700;}\neng{color: cyan;font-weight: 700;}\ntalk{color: lightcyan;font-weight: 700;}\nother { color:hsl(300,60%,70%);font-weight: 700;}\n\nh1 { color:hsl(60,60%,70%);}\nh2 { color:hsl(90,60%,70%);}\nh3 { color:hsl(120,60%,70%);}\nh4 { color:hsl(150,60%,70%);}\nh5 { color:hsl(180,60%,70%);}\nh6 { color:hsl(210,60%,70%);}\n}\n	</style>\n	<style>\n		body {\n			color: gold;\n			background: black;\n		}\n\n		h2 {\n			color: hotpink;\n		}\n\n		b {\n			color: blueviolet;\n		}\n\n		::selection {\n			background: darkred;\n			color: yellow;\n		}\n\n		::-moz-selection {\n			background: darkred;\n			color: yellow;\n		}\n\n		input:hover,\n		textarea:hover {\n			border: 2px solid fuchsia;\n			box-shadow: 5px 5px 20px darkorchid;\n		}\n\n		input:active,\n		textarea:active {\n			border-color: indigo #f3f #f6f indigo;\n			border-width: 5px;\n			border-style: solid;\n			box-shadow: 5px -5px 20px darkorchid;\n		}\n\n		#tab1 {\n			/* border: 3px solid darkgoldenrod; */\n			border-collapse: collapse;\n			margin: auto;\n		}\n\n		tr:hover {\n			border: 3px solid rgba(0, 245, 255, 0.925);\n			/* box-shadow: 5px 5px 20px cyan; */\n		}\n\n		tr:nth-child(1) {\n			font-weight: bold;\n			text-align: center;\n		}\n\n		td {\n			border: 1px solid maroon;\n			padding: 2px 5px;\n		}\n\n		input {\n			height: 30px;\n			background: pink;\n			color: navy;\n			border-radius: 15px;\n		}\n\n		#div0 {\n			background: #ccc;\n		}\n\n		#div1 {\n			/* font-size: 18pt; */\n			color: yellow;\n			white-space: pre-wrap;\n			/*margin: 0 0 0 3cm;*/\n		}\n\n		#div1 input {\n			background: #fec;\n		}\n\n		#div2 input {\n			background: #aea;\n		}\n\n		#div3 input {\n			background: #ff8;\n		}\n\n		#div4 input {\n			background: #f99;\n		}\n\n		.name {\n			background: tan;\n			color: crimson;\n		}\n\n		#txt1 {\n			width: 130px;\n			height: 30px;\n		}\n\n		#myValue {\n			width: 200px;\n			background: #aca;\n		}\n\n		#myValue2 {\n			width: 200px;\n			background: snow;\n		}\n\n		.g {\n			color: gold;\n		}\n\n		.t {\n			color: tomato;\n		}\n\n		.r {\n			color: red;\n		}\n\n		.sb {\n			color: skyblue;\n		}\n\n		.ky {\n			color: khaki;\n		}\n\n		.pink {\n			color: pink;\n		}\n\n		.y {\n			color: yellow;\n		}\n\n		.o {\n			color: orange;\n		}\n\n		.yg {\n			color: yellowgreen;\n		}\n\n		.b {\n			color: lightblue;\n		}\n\n		.p {\n			color: mediumpurple;\n		}\n\n		.lg {\n			color: limegreen;\n			font-size: 0.9em;\n		}\n\n		.lsg {\n			color: lightseagreen;\n		}\n\n		.lc {\n			color: lightcyan;\n		}\n\n		.gy {\n			color: greenyellow;\n		}\n\n		.tan {\n			color: tan;\n		}\n\n		.magenta {\n			/*字體加到最粗是900*/\n			font-weight: 900;\n			/*再加陰影，就更粗，注意X軸Y軸，直排時會對調*/\n			text-shadow: 1px 1px magenta;\n			color: magenta;\n		}\n\n		#reload {\n			background: yellowgreen;\n		}\n\n		#btnHidden {\n			height: 8px;\n			width: 8px;\n			background: white;\n		}\n\n		#btnHidden:hover {\n			height: 35px;\n			width: 5cm;\n			background: white;\n		}\n	</style>\n	<style id="change"></style>\n	<script>\n		var oBody = document.getElementsByTagName("body")\n\n		function changeColor(col, bg) {\n			div1.style.color = col\n			div1.style.background = bg\n			change.innerHTML += "body {color:" + col + ";background:" + bg + ";}"\n			tab1.style.color = col\n			tab1.style.background = bg\n		}\n		function changeSize(sz) {\n			div1.style.fontSize = sz\n			change.innerHTML += ".ru {font-size:" + sz + ";}"\n			tab1.style.fontSize = sz\n		}\n		function changeFamily(ff) {\n			div1.style.fontFamily = ff\n			change.innerHTML += ".ru {font-family:" + ff + ";}"\n			tab1.style.fontFamily = ff\n		}\n		window.onload = function () {\n			btn1.onclick = function () {\n				changeColor("black", "white")\n			}\n			btn2.onclick = function () {\n				changeColor("yellow", "black")\n			}\n			btn3.onclick = function () {\n				changeColor("darkslategray", "khaki")\n			}\n			btn5.onclick = function () {\n				changeColor("darkblue", "tan")\n			}\n			btn4.onclick = function () {\n				changeColor("maroon", "#aca")\n			}\n			btn16.onclick = function () {\n				changeSize("16pt")\n			}\n			btn20.onclick = function () {\n				changeSize("20pt")\n			}\n			btn24.onclick = function () {\n				changeSize("24pt")\n			}\n			btn36.onclick = function () {\n				changeSize("36pt")\n			}\n			myValue.onkeyup = function () {\n				changeSize(myValue.value + "pt")\n			}\n			myValue2.onkeyup = function () {\n				changeFamily(myValue2.value)\n			}\n\n			txt1.onkeyup = function () {\n				div2.innerHTML = txt1.value\n			}\n\n			var acc = [\n			]\n\n			// 範例圖表\n			function addTable(ps, tab, background, Arr, nt) {\n				// 二維陣列\n				var Arr2 = []\n				// 必須加入tbody，否則無法插入td\n				tab.innerHTML = ps + "<tbody></tbody>"\n				for (var i = 0; i < Arr.length; i++) {\n					Arr2[i] = Arr[i].split(nt)\n					var oTr = document.createElement("tr")\n					// 記得用[i]\n					for (var j of Arr2[i]) {\n						var oTd = document.createElement("td")\n						oTd.innerHTML = j\n						oTr.appendChild(oTd)\n					}\n					tab.tBodies[0].appendChild(oTr)\n					tab.style.background = background\n				}\n			}\n\n			// 隱藏下方所有按鈕\n			btnHidden.onclick = function () {\n				if (divHidden.style.display == "block") {\n					divHidden.style.display = "none"\n				} else {\n					divHidden.style.display = "block"\n				}\n			}\n\n			// 內文的超連結全部加上<a>\n			function alltoHref() {\n				// zzUp()\n				// 以正規搜尋網址列，請注意$1語法\n				div1.innerHTML = div1.innerHTML\n					.replace(/(https?:\\/\\/[a-zA-Z0-9\\.\\/_\\=\\-\\?\\:\\;\\&\\%\\#\\@\\+]+)/gi, "<a href=' + "'$1'" + ' target=' + "'_blank'" + '>$1</a>")\n					.replace(/( target="_blank")+/gi, "$1")\n					.replace(/(\\<\\/a\\>)+/gi, "$1")\n				// Copy()\n			}\n			alltoHref()\n\n			// 內文加上額外標記\n			function moretag() {\n				div1.innerHTML = div1.innerHTML\n					.replace(/(“[^”]+”)/g, "<si>$1</si>")\n					// .replace(/(\([^\)]+\))/g, "<ps>$1</ps>")\n					.replace(/(（[^）]+）)/g, "<va>$1</va>")\n					// .replace(/<章>\s*(一|二|三|四|五|六|七|八|九|十)([^事鈔]+)(事鈔[^\(\s]+)\s*(.+)<\/章>/, "<書>$3$4</書>")\n					// 轉換例外的\n					// 最後才加上「額外標記 問：1.txt」\n					.replace(/﹐/g, "，")\n					.replace(/﹑/g, "、")\n					.replace(/﹕/g, "：")\n					.replace(/(《[^》]+》)/g, "<bf>$1</bf>")\n					.replace(/(〈[^〉]+〉)/g, "<by>$1</by>")\n					.replace(/(〔[^〕]+〕)/g, "<bz>$1</bz>")\n					.replace(/《問》/g, "<ask>《問》</ask>")\n					.replace(/《答》/g, "<rep>《答》</rep>")\n					.replace(/【問】/g, "<ask>【問】</ask>")\n					.replace(/【答】/g, "<rep>【答】</rep>")\n					.replace(/(問|疑)(曰|者曰|云)?(\d*)(：|。)/g, "<ask>$1$2$3$4</ask>")\n					.replace(/(答|徵|解|釋|師)(曰|者曰|云)?(\d*)(：|。)/g, "<rep>$1$2$3$4</rep>")\n				// .replace(/(問|疑)(曰|者曰|云)?(、|：|。|，)/g, "<ask>$1$2$3</ask>")\n				// .replace(/(答|徵|解|釋|師)(曰|者曰|云)?(、|：|。|，)/g, "<rep>$1$2$3</rep>")\n			}\n			moretag()\n\n			// 內文加上大綱<h2>\n			function TabToNumEveryFunction() {\n				// 大綱編號多層：tab、四個空白…，整合為一個函數\n				// zzUp()\n				// 號碼的變量\n				// 從<h3>開始\n				var j = 3\n				var m = 1\n				// 設定分層數量，0表示只1層，1表示2層\n				var AA = ' + AA + '\n				// 可自訂分層數量\n				// if (myValue.value > 0) {\n				// 	AA = myValue.value\n				// } else {\n				// 	AA = 2\n				// }\n				// 加入資料\n				var Arr1 = []\n				Arr1 = div1.innerHTML.split("\\n")\n				for (var i = 0; i < Arr1.length; i++) {\n					// 刪除空行，及行尾空白\n					Arr1[i] = Arr1[i].replace(/\s+$/, "")\n					// 大綱編號多層：tab、四個空白…，整合為一個函數\n					// 行首條件，第1層\n					if (Arr1[i]) {\n						if (Arr1[i].charAt(0) != "\t" && Arr1[i].charAt(0) != "　") {\n							Arr1[i] = "<hr><h2>" + Arr1[i] + "</h2>"\n							// m++\n						}\n					}\n				}\n				// } else if (tab4p == "t1") {\n				// 	if (myValue.value) {\n				// 		if (Arr1[i].charAt(0) != "\t" && Arr1[i].charAt(1) != "." && Arr1[i] != "" && Arr1[i].charAt(0) != "　") {\n				// 			Arr1[i] = myValue.value + Arr1[i]\n				// 			// m++\n				// 		}\n				// 	}\n				// } else if (tab4p == "4") {\n				// if (Arr1[i].substr(0, 4) != "    " && Arr1[i].charAt(1) != "." && Arr1[i] != "" && Arr1[i].charAt(0) != "　" && Arr1[i].charAt(0) != "\t") {\n				// 	Arr1[i] = m + ". " + Arr1[i]\n				// 	m++\n				// }\n				// }\n				// }\n\n				// 第2層開始\n				if (AA > 0) {\n					for (var k = 0; k < AA; k++) {\n						for (var i = 0; i < Arr1.length; i++) {\n							// 大綱編號多層：tab、四個空白…，整合為一個函數\n							// 層級的條件(倒算)\n							// if (tab4p == "t" || tab4p == "t1") {\n							if (Arr1[i].charAt(k + 1) != "\t" && Arr1[i].charAt(k + 1) != "　") {\n								if (Arr1[i].charAt(k) == "\t") {\n									Arr1[i] = Arr1[i].replace(Arr1[i].charAt(k + 1), "<h" + j + ">" + Arr1[i].charAt(k + 1)) + "</h" + j + ">"\n									// j++\n								}\n								// 新行歸零條件\n								if (Arr1[i].charAt(k) != "\t" && Arr1[i].charAt(k) != " " && Arr1[i].charAt(k) != "　" && Arr1[i].charAt(k) != "\\n" && Arr1[i].charAt(k) != "") {\n									j = 3\n								}\n							}\n							// } else if (tab4p == "4") {\n							// 層級的條件(倒算)\n							// if (Arr1[i].substr(((k + 1) * 4), 4) != "    " && Arr1[i].substr(((k + 1) * 4), 1) != "　") {\n							// 	if (Arr1[i].substr((k * 4), 4) == "    ") {\n							// 		Arr1[i] = Arr1[i].replace(Arr1[i].substr(((k + 1) * 4), 4), j + ". " + Arr1[i].substr(((k + 1) * 4), 4))\n							// 		j++\n							// 	}\n							// 	// 新行歸零條件\n							// 	if (Arr1[i].substr((k * 4), 4) != "    " && Arr1[i].substr((k * 4), 1) != " " && Arr1[i].substr((k * 4), 1) != "　" && Arr1[i].substr((k * 4), 1) != "\\n" && Arr1[i].substr((k * 4), 1) != "") {\n							// 		j = 3\n							// 	}\n							// }\n							// }\n						}\n						// 下一層<h>加1\n						j++\n					}\n				}\n				// 導回div1\n				div1.innerHTML = Arr1.join("\\n")\n			}\n			TabToNumEveryFunction()\n\n		}\n	</script>\n</head>\n\n<body>\n	<div id="divHidden" style="display: block;">\n		<input id="reload" type="button" value="重整頁面" onclick="javascript:window.location.reload()" />\n		<input id="btn1" type="button" value="白色系主題">\n		<input id="btn3" type="button" value="黃色系主題">\n		<input id="btn5" type="button" value="茶色系主題">\n		<input id="btn4" type="button" value="綠色系主題">\n		<input id="btn2" type="button" value="黑色系主題">\n\n		<input id="btn16" type="button" value="16號字">\n		<input id="btn20" type="button" value="20號字">\n		<input id="btn24" type="button" value="24號字">\n		<input id="btn36" type="button" value="36號字">\n		<input id="myValue" type="number" placeholder="輸入數字，立刻變換字體大小" />\n		<input id="myValue2" type="text" placeholder="輸入字型名稱，立刻變換字型" />\n		<textarea id="txt1" type="text" placeholder="可打字"></textarea>\n		<br />\n		<div id="div2"></div>\n		<table id="tab1"></table>\n	</div>\n\n	<input type="button" id="btnHidden" value="隱藏多餘按鈕" />\n<div id="div1"> \n'

            var end = '\n</div></body></html>'

            // 用絕對路徑寫入檔案
            fs.writeFileSync(y + afterName, head + a + end, wu)
            // 完成時返回通知
            console.log('txt more is OK: ' + y + afterName)
        }
    }
}

// 配合timeEnd()成對出現。 打印出代碼執行的時間
console.time('共耗費了')

// 啟用函數
XmlAddMypb('./')
// 完成時返回通知
console.log('==========All txt more is OK==========')

// 'test'名字要和time()中的名字保持一致
console.timeEnd('共耗費了')